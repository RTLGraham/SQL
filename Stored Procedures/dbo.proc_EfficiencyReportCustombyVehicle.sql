SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO



CREATE PROCEDURE [dbo].[proc_EfficiencyReportCustombyVehicle]
(
	@sdate DATETIME,
	@edate DATETIME,
	@vids NVARCHAR(MAX),
	@uid UNIQUEIDENTIFIER,
	@configid UNIQUEIDENTIFIER
)
AS

--DECLARE @sdate DATETIME,
--	@edate DATETIME,
--	@vids NVARCHAR(MAX),
--	@uid UNIQUEIDENTIFIER,
--	@configid UNIQUEIDENTIFIER
--SET @vids = N'909FB8A2-A973-4253-99C1-03EAF670C13B,9F754430-BDF3-4F5A-9454-092C21FE247A,5F3CEA35-DCBE-4120-9301-09FF638BF9DF,ABAC69E6-CCCC-4E60-9F81-0B14A2CE8CFD,6913DDBF-6FAC-4E5B-A33D-0D61CA692791,7A03DFD2-3982-46E8-8C4E-12F297DEE350,8016F50D-A2D1-49A9-BC1E-13AE27953390,FE456C02-2AC4-4813-9473-13F82137005A,53B878DA-091D-4722-B467-1463EE502C19,AD7AE29D-1328-4228-B4C2-194D6C90A266,2F29E214-4249-4412-9927-1BBFF111DF1B,46D70EB7-624A-4F2D-92D7-1DB630EE116F,9264E0AD-E96D-4974-B0FD-1E50DDF18BDD,5AAB0E74-D39E-483B-AAFF-200FB5A56850,1860348D-20B5-42CF-BA66-203864BA0461,2FE4DD9B-905F-477A-A710-218A4E5C6750,EF8191E1-ABED-480F-99C3-243BC4E7EEE7,7D5C3C05-221C-47EF-8DAC-278789C406AE,04D11745-A145-4215-A432-2A5061B9DC17,AF6A1AEC-0BF5-4224-8A04-2BF2659C2739,3636AE89-04DF-4AE1-95AB-2C06253041BA,16DF929B-A773-46D2-900E-2CA8DCF23893,87A3B70E-9B8D-42CB-BB13-2E1C9427331C,2C38D238-E1A6-4E08-B419-345ACB40930F,93431E81-EE44-4EEE-A959-387B6E4F9CE3,D1742CC9-A5E3-434E-A9E8-3A1D858B1DE4,FA6E62CA-3470-4F73-A32D-3C79BF6206A9,A1AE4401-9643-4A36-94C7-3E93BE0646C4,9DFE074E-F8B7-44C0-8BAA-3FB046ED29A2,5146C0B8-5CE5-44E1-A6C6-41D2E201EF76,BD5F9889-8007-4943-9001-46CB3ED2D36F,39512BD9-7CCF-48AD-9623-46CD000D2AC6,B639621D-7C4D-4B91-8DDF-486051D96448,49482BB6-B7CC-40C1-9F61-48728BF61A8E,4DA5FA6D-8496-4D75-AA6A-4C32B377BDF9,2E7984F5-D541-4070-969B-4DEFA0130CB5,9BBD17D4-3BE2-4E29-B550-509AB56CA92F,BF48CB72-BEC8-475E-A8E3-511D485F15BF,486A43F1-70D9-46CC-A745-542B6A4D77CE,AC4A7F16-ACAF-41E5-B7CB-57C1C3123C20,339C8146-9790-4CFE-B974-5819ECC299C0,5DE385BF-BFCB-4179-90CB-5AEE460B14AD,C5868274-5850-4762-8EA8-5B5B7C1C2B5B,F30F1966-C7B8-4980-BFFE-5B930071D32D,C83D509F-26C0-4ED6-9D12-5C5D9716789D,67B44E7F-6A0E-42E0-9DCF-5DDCA2AF502E,2C1A82DE-6DCB-4D03-BC21-5F65198B9A84,991F0624-E911-4A0A-9E34-632B912A9C38,BD15D85F-F591-4AB5-881A-65E296715D18,A158F8A8-D73B-4EEF-962B-670C1BAB6696,24D1F780-C878-4FF0-A6D8-68B5FDA92CBB,33A67A70-9935-4214-B7B0-69B7AC228F5C,DB3AC174-1CFE-404C-914B-6BE9DB1B7038,8780C077-1BCB-4EF9-AC7A-6D763D0B5721,46F9F76A-1324-474B-B0BD-6E160C3E8ACD,AB2E895D-CB6F-4BD9-8CF1-71E976E6F335,C7343CE2-50EF-4AA2-AAAC-736442ECFA0A,14337BBF-9F3F-4624-9B84-73CB3485BDEE,FB0C91E1-401B-427B-B3EE-7AC8A4294BF3,202B4D58-3993-43D1-A8C5-7BC46C7CEFA5'
--SET @sdate = '2014-04-01 00:00'
--SET @edate = '2014-04-15 23:59'
--SET @uid = N'3DB40C4A-7E79-4F41-8017-DE6E12EC7A20'
--SET @configid = N'77C80BDB-5827-4C5E-BBF4-06F36ACB47D6'

	-- Determine if multiple vehicle configurations are going to be used and fork between fair and standard version appropriately
	DECLARE @configcount INT

	SELECT @configcount = ISNULL(COUNT(DISTINCT ReportConfigurationId), 0)
	FROM dbo.VehicleReportConfiguration
	WHERE VehicleId IN (SELECT Value FROM dbo.Split(@vids, ','))

	IF @configcount > 0 -- Use zero rather than one to ensure consistency when running with multiple vehicles
		EXECUTE dbo.proc_EfficiencyReportCustombyVehicle_Fair
				@sdate,
				@edate,
				@vids,
				@uid,
				@configid
	ELSE	
		EXECUTE dbo.proc_EfficiencyReportCustombyVehicle_Standard
				@sdate,
				@edate,
				@vids,
				@uid,
				@configid



GO
